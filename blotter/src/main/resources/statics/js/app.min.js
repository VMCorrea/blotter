function sendOperacao(){for(var e=document.getElementById("form_modal--save-button"),t=document.getElementById("estrategia-edit").value,a=document.getElementById("operacao-edit").value,o=document.getElementById("data-edit").value,d=document.getElementById("id-edit").value,n=document.getElementById("form_modal--list-estrategias"),i=n.getElementsByTagName("option"),r="",l=0;l<i.length;l++)i[l].value.indexOf(t)>-1&&(r=i[l].getAttribute("data-permalink"));if(""==o||""==t||""==a)alert("Preencha todos os campos!");else if(""==r)alert("Estratégia não existe!");else{var s=new Date(o),c={nome:a,estrategia:{permalink:r},dataInicio:setDataBr(s.getDate()+1,s.getMonth()+1,s.getFullYear()),id:""},m=new XMLHttpRequest,u="";"editar"==e.getAttribute("data-acao")?(u="PUT",c.id=d):"criar"==e.getAttribute("data-acao")&&(u="POST"),m.onload=function(){if(m.status>=200&&m.status<300){var e=JSON.parse(m.responseText);e.dataInicio.month+=1,console.log("Sucesso: "+m.status),console.log(m.responseText),updateTable(e,u)}else console.log("Falha: "+m.status)},console.log(c),m.open(u,"/blotter/api/operacoes/",!0),m.setRequestHeader("Content-Type","application/json; charset=utf-8"),m.send(JSON.stringify(c)),$("#modalEdit").modal("hide")}}function deleteOperacao(){if(window.confirm("Deseja deletar essa operação? Essa ação não poderá ser desfeita")){var e=document.getElementById("form_modal--delete-button").getAttribute("data-delete"),t=new XMLHttpRequest;t.onload=function(){t.status>=200&&t.status<300?(console.log("Sucesso!: "+t.status),$("#modalEdit").modal("hide"),deleteFromTable(e)):console.log("Falha!: "+t.status)},t.open("DELETE","/blotter/api/operacoes/"+e,!0),t.send()}}function updateTable(e,t){var a,o,d,n,i=document.getElementById("table_operacoes"),r=i.getElementsByTagName("tbody")[0],l=setDataBr(e.dataInicio.dayOfMonth,e.dataInicio.month,e.dataInicio.year),s=setDataUs(e.dataInicio.dayOfMonth,e.dataInicio.month,e.dataInicio.year);if("POST"==t)a=document.createElement("tr"),a.setAttribute("class","editavel"),a.setAttribute("data-toggle","modal"),a.setAttribute("data-target","#modalEdit"),a.setAttribute("data-id",e.id),a.setAttribute("data-operacao",e.nome),a.setAttribute("data-estrategia",e.estrategia.nome),a.setAttribute("data-inicio",s),a.setAttribute("data-acao","Editar"),o=document.createElement("td"),d=document.createElement("td"),n=document.createElement("td"),o.innerHTML=e.estrategia.nome,d.innerHTML=e.nome,n.innerHTML=l,a.appendChild(o),a.appendChild(d),a.appendChild(n),r.insertBefore(a,r.firstElementChild);else if("PUT"==t){var c=i.querySelector("tr[data-id='"+e.id+"']");c.getElementsByTagName("td")[0].innerHTML=e.estrategia.nome,c.getElementsByTagName("td")[1].innerHTML=e.nome,c.getElementsByTagName("td")[2].innerHTML=l,c.setAttribute("data-inicio",s),c.setAttribute("data-estrategia",e.estrategia.nome),c.setAttribute("data-operacao",e.nome)}}function deleteFromTable(e){var t=document.getElementById("table_operacoes");tr=t.querySelector("tr[data-id='"+e+"']"),tr.remove()}function setDataBr(e,t,a){return("0"+e).slice(-2)+"/"+("0"+t).slice(-2)+"/"+a}function setDataUs(e,t,a){return a+"-"+("0"+t).slice(-2)+"-"+("0"+e).slice(-2)}function hideShowElement(e){var t=document.getElementById(e),a="d-none";t.classList.contains(a)?t.classList.remove(a):t.classList.add(a)}function filtroOperacao(){var e,t,a,o;e=document.getElementById("input_filtra-operacao").value.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),t=document.getElementById("filtro"),a=document.getElementById("table_operacoes"),o=a.getElementsByClassName("editavel");for(var d=0;d<o.length;d++){var n=o[d].getElementsByTagName("td")[t.value].textContent.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");n.indexOf(e)>-1?o[d].style.display="":o[d].style.display="none"}}window.onload=function(){var e=document.getElementById("input_filtra-operacao");e.addEventListener("keyup",filtroOperacao),document.getElementById("form_modal--save-button").addEventListener("click",sendOperacao),document.getElementById("form_modal--delete-button").addEventListener("click",deleteOperacao)},$("#modalEdit").on("show.bs.modal",function(e){var t=$(e.relatedTarget),a=t.data("acao"),o=$(this),d=document.getElementById("form_modal--save-button");if(o.find("#modalEditLabel").text(a+" operação"),"Editar"==a){var n=t[0].getAttribute("data-id"),i=t[0].getAttribute("data-estrategia"),r=t[0].getAttribute("data-operacao"),l=t[0].getAttribute("data-inicio"),s=document.getElementById("form_modal--delete-button");d.setAttribute("data-acao","editar"),s.setAttribute("data-delete",n),s.disabled=!1,o.find("#estrategia-edit").val(i),o.find("#operacao-edit").val(r),document.getElementById("data-edit").value=l,o.find("#id-edit").val(n)}else o.find("#estrategia-edit").val(""),o.find("#operacao-edit").val(""),o.find("#data-edit").val(""),d.setAttribute("data-acao","criar"),s.disabled=!0});