function sendOperacao(){for(var e=document.getElementById("form_modal--save-button"),t=document.getElementById("estrategia-edit").value,a=document.getElementById("operacao-edit").value,o=document.getElementById("data-edit").value,d=document.getElementById("id-edit").value,n=document.getElementById("form_modal--list-estrategias").getElementsByTagName("option"),i=0,r=0;r<n.length;r++)n[r].value.indexOf(t)>-1&&(i=n[r].getAttribute("data-id"));if(""==o||""==t||""==a)alert("Preencha todos os campos!");else if(0==i)alert("Estratégia não existe!");else{var l=new Date(o),s={nome:a,estrategia:{id:i},dataInicio:setDataBr(l.getDate()+1,l.getMonth()+1,l.getFullYear()),id:""},c=new XMLHttpRequest,m="";"editar"==e.getAttribute("data-acao")?(m="PUT",s.id=d):"criar"==e.getAttribute("data-acao")&&(m="POST"),c.onload=function(){if(c.status>=200&&c.status<300){var e=JSON.parse(c.responseText);e.dataInicio.month+=1,console.log("Sucesso: "+c.status),console.log(c.responseText),updateTable(e,m)}else console.log("Falha: "+c.status)},console.log(s),c.open(m,"/blotter/api/operacoes/",!0),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),c.send(JSON.stringify(s)),$("#modalEdit").modal("hide")}}function deleteOperacao(){if(window.confirm("Deseja deletar essa operação? Essa ação não poderá ser desfeita.")){var e=document.getElementById("form_modal--delete-button").getAttribute("data-delete"),t=new XMLHttpRequest;t.onload=function(){t.status>=200&&t.status<300?(console.log("Sucesso!: "+t.status),$("#modalEdit").modal("hide"),deleteFromTable(e)):console.log("Falha!: "+t.status)},t.open("DELETE","/blotter/api/operacoes/"+e,!0),t.send()}}function updateTable(e,t){var a=document.getElementById("table_operacoes"),o=a.getElementsByTagName("tbody")[0],d=setDataBr(e.dataInicio.dayOfMonth,e.dataInicio.month,e.dataInicio.year),n=setDataUs(e.dataInicio.dayOfMonth,e.dataInicio.month,e.dataInicio.year);if("POST"==t){var i,r,l,s;(i=document.createElement("tr")).setAttribute("class","editavel"),i.setAttribute("data-toggle","modal"),i.setAttribute("data-target","#modalEdit"),i.setAttribute("data-id",e.id),i.setAttribute("data-operacao",e.nome),i.setAttribute("data-estrategia",e.estrategia.nome),i.setAttribute("data-inicio",n),i.setAttribute("data-acao","Editar"),r=document.createElement("td"),l=document.createElement("td"),s=document.createElement("td"),r.innerHTML=e.estrategia.nome,l.innerHTML=e.nome,s.innerHTML=d,i.appendChild(r),i.appendChild(l),i.appendChild(s),o.insertBefore(i,o.firstElementChild)}else if("PUT"==t){var c=a.querySelector("tr[data-id='"+e.id+"']");c.getElementsByTagName("td")[0].innerHTML=e.estrategia.nome,c.getElementsByTagName("td")[1].innerHTML=e.nome,c.getElementsByTagName("td")[2].innerHTML=d,c.setAttribute("data-inicio",n),c.setAttribute("data-estrategia",e.estrategia.nome),c.setAttribute("data-operacao",e.nome)}}function deleteFromTable(e){var t=document.getElementById("table_operacoes");tr=t.querySelector("tr[data-id='"+e+"']"),tr.remove()}function setDataBr(e,t,a){return("0"+e).slice(-2)+"/"+("0"+t).slice(-2)+"/"+a}function setDataUs(e,t,a){return a+"-"+("0"+t).slice(-2)+"-"+("0"+e).slice(-2)}function hideShowElement(e){var t=document.getElementById(e);t.classList.contains("d-none")?t.classList.remove("d-none"):t.classList.add("d-none")}function filtroOperacao(){var e,t,a;e=document.getElementById("input_filtra-operacao").value.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),t=document.getElementById("filtro"),a=document.getElementById("table_operacoes").getElementsByClassName("editavel");for(var o=0;o<a.length;o++){a[o].getElementsByTagName("td")[t.value].textContent.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").indexOf(e)>-1?a[o].style.display="":a[o].style.display="none"}}window.onload=function(){document.getElementById("input_filtra-operacao").addEventListener("keyup",filtroOperacao),document.getElementById("form_modal--save-button").addEventListener("click",sendOperacao),document.getElementById("form_modal--delete-button").addEventListener("click",deleteOperacao)},$("#modalEdit").on("show.bs.modal",function(e){var t=$(e.relatedTarget),a=t.data("acao"),o=$(this),d=document.getElementById("form_modal--save-button"),n=document.getElementById("form_modal--delete-button");if(o.find("#modalEditLabel").text(a+" operação"),"Editar"==a){var i=t[0].getAttribute("data-id"),r=t[0].getAttribute("data-estrategia"),l=t[0].getAttribute("data-operacao"),s=t[0].getAttribute("data-inicio");d.setAttribute("data-acao","editar"),n.setAttribute("data-delete",i),n.disabled=!1,o.find("#estrategia-edit").val(r),o.find("#operacao-edit").val(l),document.getElementById("data-edit").value=s,o.find("#id-edit").val(i)}else o.find("#estrategia-edit").val(""),o.find("#operacao-edit").val(""),o.find("#data-edit").val(""),d.setAttribute("data-acao","criar"),n.disabled=!0});